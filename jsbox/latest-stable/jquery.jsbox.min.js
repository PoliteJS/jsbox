/* JSBox v3.1.1 | by Marco Pegoraro | http://politejs.com/jsbox */


(function() {
    function subscribe(a,b,c){a._subscriptions||(a._subscriptions={}),a._subscriptions[b]||(a._subscriptions[b]=[]),a._subscriptions[b].push(c)}function publish(a,b){var c=Array.prototype.slice.call(arguments);c.shift(),c.shift(),a._subscriptions&&a._subscriptions[b]&&a._subscriptions[b].forEach(function(b){b.apply(a,c)})}function disposePubSub(a){a._subscriptions&&(a._subscriptions=null)}function boxSources(a){var b={};return Object.keys(a.editors).forEach(function(c){b[c]=a.editors[c].getSource()}),b}function initSandbox(a){a.sandbox=a.options.engines.sandbox.create(a.options.sandbox),a.sandbox.on("finish",function(b,c){c===!0&&setTimeout(function(){publish(a,"success",a)},0),c===!1&&setTimeout(function(){publish(a,"error",a)},0),setTimeout(function(){publish(a,"status",a,c,b)},0)})}function disposeSandbox(a){a.sandbox.dispose()}function initEditors(a){Object.keys(a.options.editors).forEach(function(b){if(a.options.editors[b]!==!1){var c="";"string"==typeof a.options.editors[b]&&(c=a.options.editors[b]),a.editors[b]=a.options.engines.editor.create({language:b,source:c}),a.editors[b].on("cmd-execute",a.execute.bind(a)),a.editors[b].on("cmd-reset",a.reset.bind(a))}})}function disposeEditors(a){Object.keys(a.editors).forEach(function(b){a.editors[b].dispose()}),a.editors=null}function resetEditors(a){Object.keys(a.editors).forEach(function(b){a.editors[b].reset()})}function initLogger(a){a.logger=a.options.engines.logger.create(),["log","warn","error","assertion-passed","assertion-failed"].forEach(function(b){a.sandbox.on(b,function(c){a.logger.push(b,c)})}),a.sandbox.on("exception",function(b){a.logger.push("exception",b.message)})}function disposeLogger(a){a.logger.dispose()}function initTestsList(a){a.testsList=a.options.engines.testsList.create(a.options.tests),a.sandbox.on("test-result",function(b,c){a.testsList.setStatus(b,c)})}function disposeTestsList(a){a.testsList.dispose()}function initDOM(a){a.el=dom.create("div","","jsbox"),a.template=a.options.engines.template.create(a)}function disposeDOM(a){a.template.dispose(),dom.remove(a.el)}function createJsbox(a){var b=Object.create(JSBox);return b.init(a),jsboxes.push(b),b.on("active-status-changed",function(a){a&&jsboxes.filter(function(a){return a!==b}).forEach(function(a){a.setActive(!1)})}),b.on("dispose",function(){var a=jsboxes.indexOf(b);-1!==a&&jsboxes.splice(a,1)}),b}var extend=jQuery.extend,dom=function(a){return{create:function(b,c,d,e){var f=a("<"+b+">");return c&&f.attr("id",c),d&&f.addClass(d),e&&f.append(e),f[0]},append:function(b,c){a(c).append(b)},remove:function(b){a(b).remove()},empty:function(b){a(b).empty()},addClass:function(b,c){a(b).addClass(c)},removeClass:function(b,c){a(b).removeClass(c)},addEvent:function(b,c,d){a(b).on(c,d)},clearEvents:function(b){a(b).off()}}}(jQuery),textEditorEngine={create:null};!function(){function a(a){var b=a.el;dom.addEvent(b,"keydown",function(c){var d=c.keyCode||c.which;9==d&&(c.preventDefault(),b.value=[b.value.substring(0,b.selectionStart),b.value.substring(b.selectionEnd)].join(" "),b.selectionStart=b.selectionEnd=b.selectionStart+2),(13==d&&c.ctrlKey||13==d&&c.metaKey)&&(c.preventDefault(),c.stopPropagation(),publish(a,"cmd-execute")),(8==d&&c.ctrlKey||8==d&&c.metaKey)&&(c.preventDefault(),c.stopPropagation(),publish(a,"cmd-reset"))})}function b(a){var b=a.el;dom.addEvent(b,"keyup",function(){clearTimeout(a._timer),a._timer=setTimeout(function(){publish(a,"source-update",a.getSource()),c(a)},a.options.sourceDelay)})}function c(a){var b=a.el;clearTimeout(a._autosize),a._autosize=setTimeout(function(){b.style.height="auto",b.style.height=b.scrollHeight+15+"px"},a.options.autosizeDelay)}var d={language:"txt",source:"",sourceDelay:0,autosizeDelay:0},e={init:function(c){this.options=extend({},d,c||{}),this.el=dom.create("textarea",null,"jsbox-texted jsbox-texted-"+this.options.language),this.el.setAttribute("placeholder",this.options.language),this.setSource(this.options.source,!0),a(this),b(this)},dispose:function(){dom.clearEvents(this.el),dom.remove(this.el),this.el=null,disposePubSub(this)},reset:function(){this.setSource(this.options.source,!0)},on:function(a,b){subscribe(this,a,b)},getSource:function(){return this.el.value},setSource:function(a,b){this.el.value=unescape(escape(a)),c(this),b===!0&&publish(this,"source-update",a)}};textEditorEngine.create=function(a){var b=Object.create(e);return b.init(a),b}}();var aceEditorEngine={create:null};!function(){var a={language:"txt",source:"",sourceDelay:0,autosizeDelay:0},b={init:function(b){var c=this;switch(this.options=extend({},a,b||{}),this.el=dom.create("div",null,"jsbox-ace jsbox-ace-"+this.options.language),this.ace=ace.edit(this.el),this.options.language){case"html":this.ace.getSession().setMode("ace/mode/html");break;case"css":this.ace.getSession().setMode("ace/mode/css");break;case"js":this.ace.getSession().setMode("ace/mode/javascript")}this.options.theme&&this.ace.setTheme("ace/theme/"+this.options.theme),this.ace.commands.addCommand({name:"executeShortcut",bindKey:{win:"Ctrl-Return",mac:"Command-Return"},exec:function(){publish(c,"cmd-execute")}}),this.ace.commands.addCommand({name:"resetShortcut",bindKey:{win:"Ctrl-Backspace",mac:"Command-Backspace"},exec:function(){publish(c,"cmd-reset")}}),this.ace.on("focus",function(){publish(c,"focus")}),this.ace.on("blur",function(){publish(c,"blur")}),this.setSource(this.options.source,!0)},dispose:function(){this.ace.destroy(),dom.clearEvents(this.el),dom.remove(this.el),this.el=null,disposePubSub(this)},reset:function(){this.setSource(this.options.source,!0)},on:function(a,b){subscribe(this,a,b)},getSource:function(){return this.ace.getSession().getValue()},setSource:function(a,b){this.ace.getSession().setValue(a),b===!0&&publish(this,"source-update",a)}};aceEditorEngine.create=function(a){var c=Object.create(b);return c.init(a),c}}();var sandboxEngine={create:null};!function(){function a(a,e,f){var h=a.iframe.contentWindow,i=!1;publish(a,"start",h),e=extend({js:"",css:"",html:""},e),g(a,h),h.sandboxSourceErrors=function(b){publish(a,"exception",b)},h.jsboxTest=function(){b(a,h,f)},h.jsboxSyncEnd=function(){i||-1===e.js.indexOf("jsboxTest()")||(i=!0),i||h.jsboxTest()},h.jsboxAsync=function(){return i=!0,h.jsboxTest};var j="";a.options.styles.forEach(function(a){j+='<link rel="stylesheet" href="'+d(a)+'"></script>'});var k="";a.options.scripts.forEach(function(a){k+='<script src="'+c(a)+'"></script>'});var l="";a.options.artifax.forEach(function(a){l+="<script>try {"+a+"\n} catch(e) {}</script>"}),h.jsbox={source:{js:e.js,css:e.css,html:e.html}},h.document.open(),h.document.write(["<html><head>",j,"<style>"+e.css+"\n</style>",k,l,"</head><body>",e.html+"\n","<script>","try {"+e.js+"\n} catch(e) {sandboxSourceErrors(e)};","jsboxSyncEnd();","</script></body></html>"].join("")),h.document.close()}function b(a,b,c){var d=null;c.forEach(function(c,e){b.sandboxTestResultsHandler=function(f){publish(a,"test-result",c,f,e,b),d=null===d?f:d&&f};var f=document.createElement("script");f.appendChild(document.createTextNode("try {sandboxTestResultsHandler("+c+")} catch (e) {sandboxTestResultsHandler(false)}")),b.document.body.appendChild(f)}),publish(a,"finish",b,d)}function c(a){var b="";if(-1!==a.indexOf("//")||-1!==a.indexOf(".js"))return a;if(-1!==a.indexOf("@")){var c=a.split("@"),b=c[1];a=c[0]}switch(a){case"sinonjs":case"sinon":b=b||"1.7.3",a="//cdnjs.cloudflare.com/ajax/libs/sinon.js/@@@/sinon-min.js";break;case"jquery":case"jq":case"$":b=b||"2.1.1",a="//cdnjs.cloudflare.com/ajax/libs/jquery/@@@/jquery.min.js";break;case"underscore":case"_":b=b||"1.6.0",a="//cdnjs.cloudflare.com/ajax/libs/underscore.js/@@@/underscore-min.js";break;case"knockoutjs":case"knockout":case"ko":b=b||"3.1.0",a="//cdnjs.cloudflare.com/ajax/libs/knockout/@@@/knockout-min.js";break;case"backbonejs":case"backbone":b=b||"1.1.2",a="//cdnjs.cloudflare.com/ajax/libs/backbone.js/@@@/backbone-min.js";break;case"mochajs":case"mocha":b=b||"1.20.1",a="//cdnjs.cloudflare.com/ajax/libs/mocha/@@@/mocha.js";break;case"chaijs":case"chai":b=b||"1.9.1",a="//cdnjs.cloudflare.com/ajax/libs/chai/@@@/chai.min.js"}return a.replace("@@@",b)}function d(a){return a}function e(a){a.iframe=dom.create("iframe",null,"jsbox-sandbox-runner"),dom.append(a.iframe,a.el)}function f(a){a.iframe&&(dom.remove(a.iframe),a.iframe=null)}function g(a,b){b.console={},["log","warn","error"].forEach(function(c){b.console[c]=function(){var b=Array.prototype.slice.call(arguments);publish(a,c,h(b),b)}}),b.console.assert=function(b,c){b===!0?publish(a,"assertion-passed",c):publish(a,"assertion-failed",c)}}function h(a){return a.map(i).join(", ")}function i(a){switch(typeof a){case"string":return'"'+a+'"';case"object":return"[object Date]"===Object.prototype.toString.call(a)?a.toString():Array.isArray(a)?"["+a.map(i).join(", ")+"]":"{"+Object.keys(a).map(function(b){return b+":"+i(a[b])}).join(", ")+"}";case"function":return a.toString();case"boolean":return a.toString().toUpperCase()}return a}var j={timeout:1e4,artifax:[],scripts:[],styles:[]},k={init:function(a){this.options=extend({},j,a||{}),this.el=dom.create("div",null,"jsbox-sandbox"),a.visible===!1&&dom.addClass(this.el,"jsbox-sandbox-hidden"),this.reset(!0)},dispose:function(){f(this),disposePubSub(this),this.el=null},on:function(a,b){subscribe(this,a,b)},execute:function(b,c){this.reset(!0),a(this,b,c)},reset:function(a){f(this),e(this),a!==!0&&publish(this,"reset")}};sandboxEngine.create=function(a){var b=Object.create(k);return b.init(a),b}}();var loggerEngine={create:null};!function(){var a={init:function(){this.el=dom.create("ul",null,"jsbox-logger"),this.logs=[]},dispose:function(){this.reset(),dom.remove(this.el)},push:function(a,b){var c=dom.create("li",null,"jsbox-logger-item jsbox-logger-item-"+a,b);dom.append(c,this.el)},reset:function(){dom.empty(this.el)}};loggerEngine.create=function(){var b=Object.create(a);return b.init(),b}}();var testsListEngine={create:null};!function(){var a={init:function(a){this.el=dom.create("ul",null,"jsbox-tests-list"),this.tests=[],this.reset(),a.forEach(this.push.bind(this))},dispose:function(){dom.remove(this.el)},push:function(a){var b=dom.create("li",null,"jsbox-tests-list-item",a.label||a.code);dom.append(b,this.el),dom.removeClass(this.el,"jsbox-tests-list-empty"),this.tests.push({code:a.code,el:b})},getList:function(){return this.tests.map(function(a){return a.code})},reset:function(){0===this.tests.length?dom.addClass(this.el,"jsbox-tests-list-empty"):dom.removeClass(this.el,"jsbox-tests-list-empty"),this.tests.forEach(function(a){dom.removeClass(a.el,"jsbox-tests-list-item-ok"),dom.removeClass(a.el,"jsbox-tests-list-item-ko")})},setStatus:function(a,b){this.tests.filter(function(b){return b.code===a}).forEach(function(a){b?dom.addClass(a.el,"jsbox-tests-list-item-ok"):dom.addClass(a.el,"jsbox-tests-list-item-ko")})}};testsListEngine.create=function(b){var c=Object.create(a);return c.init(b||[]),c}}();var templateEngine={create:null};!function(){function a(a,b,c){a.classList.add("jsbox-tpl-simple"),["testsList"].forEach(function(b){var d=dom.create("div",null,"jsbox-tpl-wrapper jsbox-tpl-wrapper-"+b);dom.append(c[b].el,d),dom.append(d,a)});var d=dom.create("div",null,"jsbox-tpl-wrapper-editors");for(var e in c.editors){var f=dom.create("div",null,"jsbox-tpl-wrapper jsbox-tpl-wrapper-"+e);dom.append(c.editors[e].el,f),dom.append(f,d)}dom.append(d,a),["logger","sandbox"].forEach(function(b){var d=dom.create("div",null,"jsbox-tpl-wrapper jsbox-tpl-wrapper-"+b);dom.append(c[b].el,d),dom.append(d,a)});var g=dom.create("div",null,"jsbox-tpl-wrapper-buttons"),h=dom.create("button",null,"jsbox-cmd jsbox-cmd-execute","Run &raquo;"),i=dom.create("button",null,"jsbox-cmd jsbox-cmd-reset","Reset");dom.addEvent(h,"click",c.execute.bind(c)),dom.addEvent(i,"click",c.reset.bind(c)),dom.append(i,g),dom.append(h,g),dom.append(g,a);var j=dom.create("div",null,"jsbox-tpl-overlay","<p>"+c.options.disabledMsg+"</p>");dom.append(j,a)}function b(a){dom.addEvent(a.el,"click",function(){a.isEnabled()&&(a.isActive()||(a.setActive(!0),dom.removeClass(a.el,"jsbox-failed")))}),a.on("enabled-status-changed",function(b){b?(dom.addClass(a.el,"jsbox-enabled"),dom.removeClass(a.el,"jsbox-disabled")):(dom.removeClass(a.el,"jsbox-enabled"),dom.addClass(a.el,"jsbox-disabled"))}),a.on("active-status-changed",function(b){b?dom.addClass(a.el,"jsbox-active"):dom.removeClass(a.el,"jsbox-active")}),a.sandbox.on("reset",function(){dom.removeClass(a.el,"jsbox-success"),dom.removeClass(a.el,"jsbox-failed")}),a.sandbox.on("start",function(){dom.removeClass(a.el,"jsbox-success"),dom.removeClass(a.el,"jsbox-failed"),dom.addClass(a.el,"jsbox-running")}),a.sandbox.on("finish",function(b,c){dom.removeClass(a.el,"jsbox-running"),c===!0&&dom.addClass(a.el,"jsbox-success"),c===!1&&dom.addClass(a.el,"jsbox-failed"),a.isActive()&&(clearTimeout(a.template._checkActiveTimer),a.template._checkActiveTimer=setTimeout(function(){dom.removeClass(a.el,"jsbox-failed")},3e3))})}var c={init:function(c){switch(this.el=c.el,this.box=c,this.options=c.options.template||{},"string"==typeof this.options&&(this.options={name:this.options}),this.options=extend({name:"simple"},this.options),this.options.name){case"simple":a(this.el,this.options,this.box);break;case"advanced":dom.append("-- JSBox Advance Template yet to be implemented--",this.box.el);break;default:dom.append("-- JSBox unknown template--",this.box.el)}b(this.box)},dispose:function(){dom.empty(this.el)}};templateEngine.create=function(a,b){var d=Object.create(c);return d.init(a,b),d}}();var JSBoxDefaults={disabled:!1,disabledMsg:"please complete the previous exercise!",autorun:!1,editors:{html:!1,css:!1,js:""},tests:[],sandbox:{visible:!1},engines:{editor:window.ace?aceEditorEngine:textEditorEngine,sandbox:sandboxEngine,logger:loggerEngine,testsList:testsListEngine,template:templateEngine}},JSBox={init:function(a){this.options=extend({},JSBoxDefaults,a||{}),this.editors={},initSandbox(this),initEditors(this),initLogger(this),initTestsList(this),initDOM(this),this.__enabled=!1,this.__active=!1,this.setEnabled(this.options.disabled===!0?!1:!0),this.options.autorun===!0&&setTimeout(this.execute.bind(this),0)},dispose:function(){publish(this,"dispose"),disposeSandbox(this),disposeEditors(this),disposeLogger(this),disposeTestsList(this),disposeDOM(this),disposePubSub(this)},on:function(a,b){subscribe(this,a,b)},getEl:function(){return this.el},setEnabled:function(a){var b=this,c=this.__enabled;this.__enabled=a===!0?!0:!1,clearTimeout(this._setEnabledTimer),this._setEnabledTimer=setTimeout(function(){c!==b.active&&publish(b,"enabled-status-changed",b.__enabled,c)},50)},setActive:function(a){var b=this,c=this.__active;this.__active=a===!0?!0:!1,clearTimeout(this._setActiveTimer),this._setActiveTimer=setTimeout(function(){c!==b.active&&publish(b,"active-status-changed",b.__active,c)},50)},reset:function(){dom.removeClass(this.el,"jsbox-running"),this.setActive(!0),this.softReset(),resetEditors(this),publish(this,"reset")},softReset:function(){this.testsList.reset(),this.logger.reset(),this.sandbox.reset()},execute:function(){this.setActive(!0),this.softReset(),this.sandbox.execute(boxSources(this),this.testsList.getList())},isActive:function(){return this.__active},isEnabled:function(){return this.__enabled}},jsboxes=[];!function(a){function b(b){var c,d,e,f,g={editors:{html:!1,css:!1,js:""},sandbox:{visible:!1,libs:[]},tests:[]};return e=b.find("[data-js]"),e.length&&(g.editors.js=e.html()),d=b.find("[data-css]"),d.length&&(g.editors.css=d.html(),g.sandbox.visible=!0),c=b.find("[data-html]"),c.length&&(g.editors.html=c.html(),g.sandbox.visible=!0),$artifax=b.find("[data-artifax]"),$artifax.length&&($artifax.children().length?(g.sandbox.artifax=[],$artifax.children().each(function(){g.sandbox.artifax.push(a(this).html())})):g.sandbox.artifax=[$artifax.html()]),f=b.find("code").filter(function(){var b=a(this);return void 0!==b.attr("data-html")||void 0!==b.attr("data-css")||void 0!==b.attr("data-js")||void 0!==b.attr("data-artifax")?!1:!0}),!e.length&&f.length&&(g.editors.js=f.html()),b.attr("data-jsbox-scripts")&&(g.sandbox.scripts=b.attr("data-jsbox-scripts").split(",")),b.attr("data-jsbox-styles")&&(g.sandbox.styles=b.attr("data-jsbox-styles").split(",")),b.find("[data-test]").each(function(){g.tests.push(a(this).attr("data-test").length?{code:a(this).attr("data-test"),label:a(this).html()}:{code:a(this).html(),label:""})}),b.is("[data-jsbox-lock]")&&(g.next=b.attr("data-jsbox-next","next")),b.attr("data-jsbox-next")&&(g.next=b.attr("data-jsbox-next")),b.is("[data-jsbox-autorun]")&&(g.autorun=!0),b.is("[data-jsbox-disabled]")&&(g.disabled=!0,b.attr("data-jsbox-disabled")&&(g.disabledMsg=b.attr("data-jsbox-disabled"))),g}function c(c){var e=a(this);if(!e.data("jsbox")||e.data("jsbox")===!0){c=a.extend(!0,{},c,b(e));var f=createJsbox(c);d(f,c,e),e.addClass("jsbox-plugin-enabled").after(f.getEl()).data("jsbox",f).trigger("jsbox-ready",f)}}function d(b,c,d){if(c.next){var e,f;e="next"===c.next?d.nextAll("[data-jsbox]").first():a(c.next),e.on("jsbox-ready",function(a,b){f=b,f.setEnabled(!1)}),b.on("success",function(){f&&f.setEnabled(!0)}),b.on("dispose",function(){f&&f.setEnabled(!0)})}}function e(){var b=a(this),c=b.data("jsbox");c&&(c.dispose(),c=null,a.removeData(this,"jsbox")),b.removeClass("jsbox-plugin-enabled")}a.jsboxDefaults={},a.fn.jsbox=function(){var b=a(this),d=Array.prototype.slice.call(arguments);if(d.length)if(a.isPlainObject(d[0])){var f=a.extend({},a.jsboxDefaults,d[0]);b.each(c,[f])}else switch(d[0]){case"instance":return b.data("jsbox");case"dispose":b.each(e);break;default:throw'JSBox does not support "'+d[0].toString()+'" API call'}else b.each(c,[a.jsboxDefaults]);return this},a(document).ready(function(){a("[data-jsbox]").jsbox()})}(jQuery);
})();
